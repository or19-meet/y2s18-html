Previewdialog=function(n){var t=this;t.dom;t.drawningboard=n;t.previewspace;t.savedialog;t.SvgTools=new SvgTools;t.prepareCompanyName=function(){var n="";return $.each(t.drawningboard.cliplist,function(t,i){if(i instanceof Text&&i.enabled()){if(n.length+i.format.text.length>25)return n==""?i.format.text:n;n==""?n=i.format.text:n+=" "+i.format.text}}),n};t.loadOwnerPreview=function(){$.ajax({type:"GET",url:"/ownerpreview"}).done(function(n){t.dom=$(n);t.dom.hide();$("#logobody").append(t.dom);t.registerEvents();t.populatePreviewImages();t.dom.show()})};t.start=function(){var n,i,r;if(t.drawningboard.selector.unselect(),t.drawningboard.selector.endexplodedmode(),$("#logomaker").hasClass("ownermode")){t.loadOwnerPreview();return}t.drawningboard.startloading();t.savedialog=new SaveDialog(t.drawningboard);n=t.savedialog.geticondata();t.drawningboard.plan&&(n.guid=t.drawningboard.icon);i={logo:n};r=function(n){n.wrap("<div><\/div>");n.attr("width","600px");n.attr("height","600px");i.svg=n.parent().html().replace(/NS\d+:href/gi,"xlink:href");var r=t.prepareCompanyName();$.ajax({type:"post",url:t.drawningboard.api.logo+"userstore",data:JSON.stringify(i),contentType:"application/json; charset=utf-8",dataType:"json"}).done(function(n){var i,u;console.log(n);i={guid:n.obj.logo.guid};window.history.pushState(i,"Free Logo Design",t.drawningboard.api.editorPage+"?lang="+t.drawningboard.api.language+"&logo="+n.obj.logo.guid);u=t.drawningboard.api.previewPage+"?lang="+t.drawningboard.api.language+"&name="+encodeURI(r)+"&logo="+n.obj.logo.guid;window.location=u})};t.SvgTools.getthumb(n,!1,!1,r,!0)};t.populatePreviewImages=function(){var u=[],i,n,r,f,e,o;($.each(t.drawningboard.cliplist,function(n,t){t.enabled()&&u.push(t)}),u.length!=0)&&(i=t.drawningboard.selector.getclipdata(u),n=t.drawningboard.recentcolors[0],(n.r>200&&n.g>200&&n.b>200||n.a<.5)&&(r=!1,$.each(t.drawningboard.recentcolors,function(t,i){r||(i.r<200||i.g<200||i.b<200)&&i.a>.5&&(r=!0,n=i)}),r||(n.r=35,n.g=143,n.b=180,n.a=1)),f="rgba("+n.r+", "+n.g+", "+n.b+", "+n.a+")",e="rgba("+n.r+", "+n.g+", "+n.b+", 0.3)",t.dom.find(".customcolor").css("color",f),t.dom.find(".custombg").css("background-color",f),t.dom.find(".preview-monitor-layout").css("border-right","1px solid "+e),t.dom.find(".preview-monitor-layout").css("border-left","1px solid "+e),o=Snap(t.drawningboard.workspace.node.cloneNode(!0)),o.attr({viewBox:i.x1+","+i.y1+","+i.width+","+(i.height+20)}),t.previewspace=Snap("svg.edit-image"),t.previewspace.add(o),t.dom.find("img.edit-image").hide(),$("#edit-image").find(".selector-part, .background-part").remove(),t.dom.find('[style*="cursor: move"]').css("cursor","default"))};t.return=function(){t.savedialog&&t.savedialog.hide();t.dom.slideUp("fast",function(){t.dom.remove()});$.each(t.drawningboard.cliplist,function(n,t){t.update()})};t.registerEvents=function(){t.dom.find(".edit-buttom").on("click",function(){t.return()});t.dom.find(".download-free-box").on("click",function(){t.drawningboard.ownermode&&(t.savedialog=new SaveDialog(t.drawningboard),t.savedialog.callback=t.return,t.savedialog.show())})}}