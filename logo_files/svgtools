SvgTools=function(){this.getthumb=function(n,t,r,u,f){function g(n){var e=['xmlns:ns1=""','xmlns:NS1=""','xmlns:NS2=""','xmlns:NS3=""','xmlns:ns2=""','xmlns:ns3=""','xmlns:inkscape=""','xmlns:sodipodi=""','xmlns:sketch=""'],o,t,r;for(i=0;i<e.length;i++)n.svg=n.svg.replace(new RegExp(e[i],"g"),"");o=$(n.svg);t=Snap(o[0]);n.gradient=new Gradient;n.gradient.decode(n.color);var s="path, polygon, rect, circle, ellipse, polyline",f={},c=t.selectAll(s)[0].attr();f.fill=n.gradient.getsvgcolor(t);for(r in c)c.hasOwnProperty(r)&&(r.match(/:/g)||[]).length>1&&(f[r]="");t.selectAll(s).attr(f);var l=h.snapgroup.g(),u={x:n.width/2*n.scale_x-n.width*n.flip_x*n.scale_x,y:n.height/2*n.scale_y-n.height*n.flip_y*n.scale_y},a=parseFloat(n.offset_x-u.x),v=parseFloat(n.offset_y-u.y),y=n.scale_x*(parseInt(n.flip_x)?-1:1),p=n.scale_y*(parseInt(n.flip_y)?-1:1),w=parseInt(calc.fixDegree(n.rotation));l.attr({transform:"translate("+a+","+v+") rotate("+w+","+u.x+","+u.y+") scale("+y+","+p+")"});l.append(t)}function nt(n,i){function it(){var t,i;v.attr("width",o);v.attr("height",n.height);c||v.css("overflow","visible");u.enabled?(f.attr({dy:"",textpath:k,"text-anchor":"middle",x:"",y:""}),u.type!="up"&&(u.startheight?f.attr({dy:u.startheight*.75}):f.attr({dy:n.height*.75})),$(f.node.childNodes[0]).attr({startOffset:"50%"})):c?g.attr({transform:"matrix(1 0 0 1 0 "+n.height*.75+")"}):f.attr({dy:n.height*.75,x:n.width/2});t=u.enabled?{x:n.width/2*n.scale_x-n.width*n.flip_x*n.scale_x,y:n.height/2*n.scale_y-n.height*n.flip_y*n.scale_y}:{x:n.width/2*n.scale_x-n.width*n.flip_x*n.scale_x,y:n.height/2*n.scale_y-n.height*n.flip_y*n.scale_y};i=a?parseFloat(a-t.x):parseFloat(n.offset_x-t.x);var r=parseFloat(n.offset_y-t.y),e=n.scale_x*(parseInt(n.flip_x)?-1:1),s=n.scale_y*(parseInt(n.flip_y)?-1:1),h=parseInt(calc.fixDegree(n.rotation));b.attr({transform:"translate("+i+","+r+") rotate("+h+","+t.x+","+t.y+") scale("+e+","+s+")"});$(n).data("ready",!0)}function rt(n){var t=n.font.replace(/\s/g,"").toLowerCase();return n.bold&&n.italic?t+="-bold-italic":n.italic?t+="-italic":n.bold&&(t+="-bold"),t}var v=$("<svg width='90' height='90'><\/svg>"),e=Snap(v[0]),d,f,l,y,p,w,nt,tt,a;n.gradient=new Gradient;n.gradient.decode(n.color);var b=h.snapgroup.g(),g=e.g(),k=e.path();k.attr("fill","none");var r=JSON.parse(n.format),u=JSON.parse(n.curvedline),o=n.width;s.push(r.font);d=rt(r);i&&!u.enabled?(f=g.path(),b.append(e),opentype.load("/Content/clientfonts/"+d+".woff",function(t,i){if(t)console.log("Could not load font "+d+": "+t);else{var u=i.getPath(r.text,0,0,r.size);fontPath=u.toPathData();f.attr({d:fontPath,fill:n.gradient.getsvgcolor(e)});it()}})):(b.append(e),f=e.text(),k.attr({d:"M"+u.left.x+","+u.left.y+" C"+u.anchorleft.x+","+u.anchorleft.y+" "+u.anchorright.x+","+u.anchorright.y+" "+u.right.x+","+u.right.y}),t&&t.trim()!=""&&t!="false"?(l="",r.text.trim().replaceAll("  "," ").replaceAll("  "," ").toLowerCase()=="company name"?l=t:(y=t.indexOf(" "),y>0?(p=t.substring(0,y),w=t.substring(y+1)):(p=t,w=""),l=r.text.trim().toLowerCase()=="company"?p:r.text.trim().toLowerCase()=="name"?w:r.text),f.node.textContent=l,nt=r.text.length,tt=l.length,u.enabled||(o=o/nt*tt,n.width!=o&&(r.alignment=="left"?a=n.offset_x-(n.width-o)*n.scale_x/2:r.alignment=="right"&&(a=n.offset_x+(n.width-o)*n.scale_x/2)))):f.node.textContent=r.text,f.attr({"font-size":r.size,"font-style":r.italic||r.font=="Molle"?"italic":"","font-weight":r.bold?"bold":"","font-family":r.font,textpath:undefined,fill:n.gradient.getsvgcolor(e,o,n.height),"text-anchor":"Middle"}),it())}function k(){var u,t=-1,n=window.navigator.userAgent,i=n.indexOf("MSIE "),f=n.indexOf("Trident/"),r;return i>0?t=parseInt(n.substring(i+5,n.indexOf(".",i)),10):f>0&&(r=n.indexOf("rv:"),t=parseInt(n.substring(r+3,n.indexOf(".",r)),10)),t>-1?t:u}var h=this,c=!1,o,a,y,l,e,s,v,p,w;if(typeof u=="undefined"?u=!1:c=!0,typeof f=="undefined"&&(f=!1),this.svg=f?$("<svg class='thumb' width='600' height='600'><\/svg>"):$("<svg class='thumb' width='"+n.width+"' height='"+n.height+"'><\/svg>"),o={svg:this.svg},s=[],this.snapitem=Snap(this.svg[0]),this.snapgroup=this.snapitem.g(),this.snapitem.attr({viewBox:"0,0,"+this.svg.attr("width")+","+this.svg.attr("height")}),n.background_color&&(a=this.snapitem.g(),a.attr({elementType:"background"}),y=a.rect(0,0,this.svg.attr("width"),this.svg.attr("height")),l=new Gradient,l.colorlist.push(new Color(n.background_color)),l.colorlist.push(new Color(n.background_color)),y.attr("fill",l.getsvgcolor(this.snapitem))),e=[],n.shape_list&&n.shape_list.length>0&&$.each(n.shape_list,function(n,t){e[t.index]=[t,"shape"]}),n.text_list&&n.text_list.length>0&&$.each(n.text_list,function(n,t){e[t.index]=[t,"text"]}),e&&e.length>0&&$.each(e,function(n){e[n]&&(e[n][1]=="shape"?g(e[n][0]):e[n][1]=="text"&&($(e[n][0]).data("ready",!1),nt(e[n][0],c,f)))}),n.text_list&&n.text_list.length>0&&s.length>0&&r&&(s=s.filter(function(n,t,i){return t==i.indexOf(n)}),v=[],$.each(s,function(n,t){$.each(r,function(n,i){t==i.name&&v.push(i.googleimportstring)})}),p=v.join("|"),w='<style type="text/css">@import url("https://fonts.googleapis.com/css?family='+p+'");<\/style>',o.svg.find("defs").first().append(w)),k()&&k()<=11||(o.svg.attr("xmlns","http://www.w3.org/2000/svg"),o.svg.attr("xmlns:inkscape","http://www.inkscape.org/namespaces/inkscape"),o.svg.attr("xmlns:sodipodi","http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd"),o.svg.attr("xmlns:xlink","http://www.w3.org/1999/xlink"),o.svg.attr("xmlns:ns1","http://www.inkscape.org/namespaces/inkscape"),o.svg.attr("xmlns:sketch","http://www.bohemiancoding.com/sketch/ns")),o.svg.find("desc").remove(),u){function d(){var n=!0;for(i=1;i<e.length;i++)e[i][1]!="text"||$(e[i][0]).data("ready")||(n=!1);return n}function b(){if(d()){if(o.svg[0].innerHTML=o.svg[0].innerHTML.replace(/NS\d+:href/g,"xlink:href"),f){$("body").append(h.svg);var i=h.snapitem.select('g:not([elementtype="background"])'),t=i.getBBox(),n=540/t.height;t.width*n>540&&(n=540/t.width);translatex=(600-t.width*n)/2-t.x*n;translatey=(600-t.height*n)/2-t.y*n;i.attr({transform:"matrix("+n+" 0 0 "+n+" "+translatex+" "+translatey+")"});h.snapitem.append(i);h.svg.remove()}u(o.svg)}else setTimeout(b,500)}b()}else return o}}